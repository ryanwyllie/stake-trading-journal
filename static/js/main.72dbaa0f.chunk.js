(this["webpackJsonpstake-trading-journal"]=this["webpackJsonpstake-trading-journal"]||[]).push([[0],{43:function(e,t,r){},70:function(e,t,r){"use strict";r.r(t);var a=r(0),n=r.n(a),s=r(34),i=r.n(s),c=r(15),o=(r(43),r(5)),l=r(3),d=r.n(l),u=r(6),f=r(4),b=r(20),x=r(36),j=r(21),m=r.n(j),h=r(2),O=r(8),w=r(73),p=r(72),y=function(e,t){var r=t.split(" ").reduce((function(e,t){var r=t.split("-").slice(0,-1).join("-");return""!==r&&e.push(r),e}),[]),a=e.split(" ").filter((function(e){return!r.some((function(t){return e.startsWith(t)}))})).join(" ");return"".concat(a," ").concat(t)};var g=r(1),v=function(e){var t=e.title,r=void 0===t?null:t,a=e.icon,n=void 0===a?null:a,s=e.className,i=void 0===s?"":s,c=e.closeButtonClassName,o=void 0===c?"":c,l=e.dismissable,d=void 0!==l&&l,u=e.onDismiss,f=void 0===u?null:u,b=e.message;return Object(g.jsxs)("div",{className:y("relative flex items-center rounded-lg py-2 px-4",i),role:"alert",children:[d&&f&&Object(g.jsx)("button",{className:y("absolute top-0 right-0 rounded-full p-1 m-1 transform ease-in-out duration-300",o),type:"button",title:"Close",onClick:function(){return f()},children:Object(g.jsx)(p.a,{className:"w-4 h-4"})}),n&&Object(g.jsx)("div",{className:"mr-4 flex-shrink-0",style:{width:"30px",height:"30px"},children:n}),Object(g.jsxs)("div",{children:[r&&Object(g.jsx)("h3",{className:"font-bold mb-1",children:r}),Object(g.jsx)("p",{children:b})]})]})},P=function(e){var t=e.className,r=void 0===t?"":t,a=Object(O.a)(e,["className"]);return Object(g.jsx)(v,Object(h.a)({className:y("bg-red-200 text-red-900",r),closeButtonClassName:"text-red-900 hover:bg-red-300 focus:bg-red-300",icon:Object(g.jsx)(w.a,{})},a))};function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function N(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)r=s[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)r=s[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function k(e,t){var r=e.title,n=e.titleId,s=N(e,["title","titleId"]);return a.createElement("svg",R({xmlns:"http://www.w3.org/2000/svg",fill:"none",height:24,width:24,viewBox:"0 0 24 24",ref:t,"aria-labelledby":n},s),r?a.createElement("title",{id:n},r):null,a.createElement("circle",{cx:12,cy:12,r:10,stroke:"currentColor",strokeWidth:4,style:{opacity:.25}}),a.createElement("path",{fill:"currentColor",style:{opacity:.75},d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"}))}var C=a.forwardRef(k),S=(r.p,function(e){var t=e.className,r=void 0===t?"":t,a=Object(O.a)(e,["className"]);return Object(g.jsx)(C,Object(h.a)({className:y("animate-spin",r)},a))}),I=function(e){var t=(e||{}).defaultLoading,r=void 0!==t&&t,n=Object(a.useState)(r),s=Object(f.a)(n,2),i=s[0],c=s[1],o=function(){var e=Object(a.useState)(null),t=Object(f.a)(e,2),r=t[0],n=t[1],s=function(){return n(null)};return{error:function(e){var t=e||{},a=t.className,n=void 0===a?"":a,i=t.dismissable,c=void 0===i||i;return r?Object(g.jsx)(P,{className:n,title:r.title,message:r.message,dismissable:c,onDismiss:s}):null},set:n,clear:s,has:function(){return null!==r}}}(),l=o.error,d=o.set,u=o.clear,b=o.has;return{loading:i,loadingText:function(e){return i?Object(g.jsxs)("div",{className:"flex items-center",children:[Object(g.jsx)(S,{className:"mr-2"}),Object(g.jsx)("span",{children:e.loading})]}):e.default},setLoading:c,error:l,setError:d,clearError:u,hasError:b}},E=function(e){var t=e.className,r=void 0===t?"":t,a=e.children,n=Object(O.a)(e,["className","children"]);return Object(g.jsx)("h1",Object(h.a)(Object(h.a)({className:y("font-heading font-bold text-5xl text-black",r)},n),{},{children:a}))},T=r(37),M=r(7);var D=Object(a.forwardRef)((function(e,t){var r=e.className,n=void 0===r?"":r,s=e.id,i=void 0===s?Object(T.a)():s,c=e.error,o=void 0!==c&&c,l=e.debounceOnChange,d=void 0===l?void 0:l,u=e.debounceTimeout,b=void 0===u?500:u,x=e.value,j=e.onChange,m=Object(O.a)(e,["className","id","error","debounceOnChange","debounceTimeout","value","onChange"]),w=Object(a.useState)(void 0===x?"":x),p=Object(f.a)(w,2),v=p[0],P=p[1],R=Object(a.useMemo)((function(){return function(e,t){var r=null,a=0,n=void 0,s=function s(){var i=Date.now()-a;i>t?(e.apply(void 0,Object(M.a)(n)),r=null,a=0,n=void 0):r=window.setTimeout(s,t-i)};return function(){null===r&&(r=window.setTimeout(s,t));for(var e=arguments.length,i=new Array(e),c=0;c<e;c++)i[c]=arguments[c];n=i,a=Date.now()}}((function(e){d&&d(e)}),b)}),[d,b]);return Object(g.jsx)("input",Object(h.a)({ref:t,id:i,className:y("py-3 px-4 w-full rounded-lg default-transition border-2 focus:border-black ".concat(o?"border-red-500":"border-gray-300"),n),value:d?v:x,onChange:d?function(e){P(e.target.value),R(e.target.value)}:j},m))})),U=Object(a.forwardRef)((function(e,t){var r=e.children,a=e.className,n=void 0===a?"":a,s=e.type,i=void 0===s?"button":s,c=Object(O.a)(e,["children","className","type"]);return Object(g.jsx)("button",Object(h.a)(Object(h.a)({ref:t,type:i,className:y("py-3 px-4 flex items-center justify-center rounded-lg font-bold default-transition",n)},c),{},{children:r}))})),L=Object(a.forwardRef)((function(e,t){var r=e.className,a=void 0===r?"":r,n=Object(O.a)(e,["className"]);return Object(g.jsx)(U,Object(h.a)({ref:t,className:y("bg-black text-white hover:ring-4 hover:ring-gray-200 focus:ring-4 focus:ring-gray-200",a)},n))}));function Q(e){return"".concat("https://global-prd-api.hellostake.com/api","/").concat(e)}function F(e,t,r){return W.apply(this,arguments)}function W(){return(W=Object(u.a)(d.a.mark((function e(t,r,a){var n,s,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={username:t,password:r,platformType:"WEB_f5K2x3",rememberMeDays:30},a&&(n.otp=a),e.next=4,fetch(Q("sessions/v2/createSession"),{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(n)});case 4:if(!(s=e.sent).ok){e.next=12;break}return e.next=8,s.json();case 8:return i=e.sent,e.abrupt("return",{firstName:i.firstName,lastName:i.lastName,regionIdentifier:i.regionIdentifier,sessionKey:i.sessionKey,userID:i.userID,username:i.username});case 12:if(412!==s.status){e.next=16;break}return e.abrupt("return",null);case 16:return e.next=18,s.json();case 18:throw c=e.sent,new Error("Failed to login: ".concat(c.message));case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(){return(A=Object(u.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(Q("userauth/".concat(t.sessionKey)),{method:"DELETE",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer"});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e,t,r,a,n,s){return q.apply(this,arguments)}function q(){return(q=Object(u.a)(d.a.mark((function e(t,r,a,n,s,i){var c,o,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(Q("users/accounts/accountTransactions"),{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json","Stake-Session-Token":t.sessionKey},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify({direction:i?"prev":"next",from:r.toISO(),to:a.toISO(),limit:n,offset:s||null})});case 2:if(!(c=e.sent).ok){e.next=10;break}return e.next=6,c.json();case 6:return o=e.sent,e.abrupt("return",o);case 10:return e.next=12,c.json();case 12:throw l=e.sent,new Error("Failed to load transactions: ".concat(l.message));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t){return K.apply(this,arguments)}function K(){return(K=Object(u.a)(d.a.mark((function e(t,r){var a,n,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(Q("quotes/marketData/".concat(r.join(","))),{method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json","Stake-Session-Token":t.sessionKey},redirect:"follow",referrerPolicy:"no-referrer"});case 2:if(!(a=e.sent).ok){e.next=10;break}return e.next=6,a.json();case 6:return n=e.sent,e.abrupt("return",n.marketDataList);case 10:return e.next=12,a.json();case 12:throw s=e.sent,new Error("Failed to load market data: ".concat(s.message));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $=m.a.object({email:m.a.string().required().email({tlds:!1}),password:m.a.string().required(),otp:m.a.string()}),z=function(){var e=Object(o.g)(),t=Object(a.useState)(!1),r=Object(f.a)(t,2),n=r[0],s=r[1],i=Object(a.useRef)(null),c=Object(b.c)({criteriaMode:"all",resolver:Object(x.joiResolver)($)}),l=c.register,j=c.errors,m=(c.formState,c.handleSubmit),h=I(),O=h.loading,w=h.loadingText,p=h.setLoading,y=h.error,v=h.setError,P=h.clearError;Object(a.useEffect)((function(){i&&i.current&&i.current.focus()}),[]);var R=function(){var t=Object(u.a)(d.a.mark((function t(r){var a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n||r.otp){t.next=3;break}return v({title:"MFA Required",message:"You need to supply the verifcation code"}),t.abrupt("return");case 3:return P(),p(!0),t.prev=5,t.next=8,F(r.email,r.password,r.otp?r.otp:void 0);case 8:null===(a=t.sent)?(s(!0),p(!1)):(window.localStorage.setItem("user",JSON.stringify(a)),e.push("/")),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(5),v({title:"Login failed",message:t.t0.message}),p(!1);case 16:case"end":return t.stop()}}),t,null,[[5,12]])})));return function(e){return t.apply(this,arguments)}}();return Object(g.jsxs)("div",{className:"flex flex-col items-center w-screen h-screen pt-20",children:[Object(g.jsx)(E,{children:"Stake trading journal"}),y({className:"mt-4"}),Object(g.jsxs)("form",{className:"mt-12",onSubmit:m(R),style:{width:400},children:[Object(g.jsx)(D,{ref:function(e){l(e),i.current=e},name:"email",type:"text",error:!!j.email,placeholder:"Email"}),Object(g.jsx)(D,{ref:l,className:"mt-2",type:"password",name:"password",error:!!j.password,placeholder:"Password"}),n&&Object(g.jsx)(D,{ref:l,className:"mt-2",name:"otp",error:!!j.password,placeholder:"Verification code"}),Object(g.jsx)(L,{className:"mt-6 w-full text-xl text-white",type:"submit",disabled:O,children:w({loading:"Logging in...",default:"Log in"})})]})]})},H=function(e){var t=e.user,r=Object(o.g)();return Object(a.useEffect)((function(){!function(e){A.apply(this,arguments)}(t),window.localStorage.removeItem("user"),window.localStorage.removeItem("journalData"),window.localStorage.removeItem("journalLastFetchDate"),r.push("/login")}),[]),null},V=r(10),G=r(17),Y=function(e){var t=e.className,r=void 0===t?"":t,a=e.children,n=Object(O.a)(e,["className","children"]);return Object(g.jsx)("h2",Object(h.a)(Object(h.a)({className:y("font-heading font-bold text-4xl text-black",r)},n),{},{children:a}))},_=function(e){var t=e.className,r=void 0===t?"":t,a=e.children,n=Object(O.a)(e,["className","children"]);return Object(g.jsx)("h3",Object(h.a)(Object(h.a)({className:y("font-heading font-bold text-3xl text-black",r)},n),{},{children:a}))},X=function(e){var t=e.className,r=void 0===t?"":t,a=e.children,n=Object(O.a)(e,["className","children"]);return Object(g.jsx)("h4",Object(h.a)(Object(h.a)({className:y("font-heading font-bold text-2xl text-black",r)},n),{},{children:a}))},Z=function(e){var t=e.className,r=void 0===t?"":t,a=Object(O.a)(e,["className"]);return Object(g.jsx)(c.b,Object(h.a)({className:y("font-bold underline default-transition",r)},a))},ee=125;function te(e,t){return e.tranWhen<t.tranWhen?-1:e.tranWhen>t.tranWhen?1:0}function re(e,t){return e.date<t.date?-1:e.date>t.date?1:0}function ae(e,t){var r=e.buys[0].date,a=t.buys[0].date;return r<a?-1:r>a?1:0}function ne(e,t,r){var a=t.slice();return r.forEach((function(t){if("SPUR"===t.finTranTypeID){var r=t.instrument.symbol,n=G.DateTime.fromISO(t.tranWhen),s=Math.floor(n.diff(e).as("days")),i=a[s];i||(i={symbols:{},realisedProfitRaw:0,realisedProfitPercent:0,unrealisedProfitRaw:0,unrealisedProfitPercent:0,combinedProfitRaw:0,combinedProfitPercent:0,realisedCost:0,unrealisedCost:0,date:n.startOf("day").toISO()});var c=i.symbols[r];c||(c={instrument:t.instrument,buys:[],sells:[],holdingUnitCount:0,realisedProfitRaw:0,realisedProfitPercent:0,unrealisedProfitRaw:0,unrealisedProfitPercent:0,combinedProfitRaw:0,combinedProfitPercent:0,realisedCost:0,unrealisedCost:0});var o=c.buys.findIndex((function(e){return e.orderId===t.orderID}));if(o>=0){var l=c.buys[o];c.buys[o]=Object(h.a)(Object(h.a)({},l),{},{unitQuantity:l.unitQuantity+t.fillQty,totalPrice:l.totalPrice+t.tranAmount})}else c.buys=c.buys.concat({orderId:t.orderID,unitPrice:t.fillPx,unitQuantity:t.fillQty,totalPrice:t.tranAmount,date:t.tranWhen});c.holdingUnitCount+=t.fillQty,i.symbols=Object(h.a)(Object(h.a)({},i.symbols),{},Object(V.a)({},r,Object(h.a)({},c))),a[s]=Object(h.a)({},i)}})),a}function se(e,t){var r=e.slice(),a=[];return t.forEach((function(e){if("SSAL"===e.finTranTypeID){for(var t=e.instrument.symbol,n=e.fillQty,s=0;n>0&&s<r.length;){var i=r[s],c=i?i.symbols[t]:void 0;if(c&&c.holdingUnitCount>=0){var o=c.holdingUnitCount>=n?n:n-c.holdingUnitCount;r[s]=Object(h.a)(Object(h.a)({},r[s]),{},{symbols:Object(h.a)(Object(h.a)({},r[s].symbols),{},Object(V.a)({},t,Object(h.a)(Object(h.a)({},c),{},{holdingUnitCount:c.holdingUnitCount-o,sells:c.sells.concat({orderId:e.orderID,unitPrice:e.fillPx,unitQuantity:o,totalPrice:e.tranAmount,date:e.tranWhen})})))}),n-=o}s++}n>0&&a.push(Object(h.a)(Object(h.a)({},e),{},{fillQty:n}))}})),[r,a]}function ie(e,t){return e.map((function(e){if(!e)return null;var r=0,a=0,n=0,s=0,i=Object.keys(e.symbols).reduce((function(i,c){var o=e.symbols[c],l=0;o.sells.sort(re),o.buys.sort(re);var d=o.sells.reduce((function(e,t){return l+=t.unitQuantity,e+t.unitQuantity*t.unitPrice}),0),u=o.buys.reduce((function(e,t){var r=t.unitQuantity;return l>0&&(r>l?(e[0]=e[0]+l*t.unitPrice,r-=l,l=0):(e[0]=e[0]+r*t.unitPrice,l-=r,r=0)),r>0&&(e[1]=e[1]+r*t.unitPrice),e}),[0,0]),b=Object(f.a)(u,2),x=b[0],j=b[1],m=d-x,O=0===m?0:Math.abs(m)/x*100*(m<0?-1:1),w=t[c]||0,p=o.holdingUnitCount*w,y=w&&o.holdingUnitCount?p-j:0,g=0===y?0:Math.abs(y)/j*100*(y<0?-1:1),v=d+p-(x+j),P=0===v?0:Math.abs(m+y)/(x+j)*100*(v<0?-1:1);return r+=x,a+=d,n+=j,s+=p,i[c]=Object(h.a)(Object(h.a)({},o),{},{realisedProfitRaw:m,realisedProfitPercent:O,unrealisedProfitRaw:y,unrealisedProfitPercent:g,combinedProfitRaw:v,combinedProfitPercent:P,realisedCost:x,unrealisedCost:j}),i}),{}),c=a-r,o=0===c?0:Math.abs(c)/r*100*(c<0?-1:1),l=s-n,d=0===l?0:Math.abs(l)/n*100*(l<0?-1:1),u=a+s-(r+n),b=0===u?0:Math.abs(c+l)/(r+n)*100*(u<0?-1:1);return Object(h.a)(Object(h.a)({},e),{},{symbols:i,realisedProfitRaw:c,realisedProfitPercent:o,unrealisedProfitRaw:l,unrealisedProfitPercent:d,combinedProfitRaw:u,combinedProfitPercent:b,realisedCost:r,unrealisedCost:n})}))}function ce(e,t){var r=e>=0;return["".concat(r?"+":"-","$").concat(Math.abs(e).toPrecision(3)),"".concat(r?"+":"-").concat(Math.abs(t).toPrecision(3),"%")]}function oe(e){var t=ce(e.realisedProfitRaw,e.realisedProfitPercent),r=Object(f.a)(t,2),a=r[0],n=r[1],s=ce(e.unrealisedProfitRaw,e.unrealisedProfitPercent),i=Object(f.a)(s,2),c=i[0],o=i[1],l=ce(e.combinedProfitRaw,e.combinedProfitPercent),d=Object(f.a)(l,2);return{displayRealisedRaw:a,displayRealisedPercent:n,displayUnrealisedRaw:c,displayUnrealisedPercent:o,displayCombinedRaw:d[0],displayCombinedPercent:d[1]}}var le=function(e){var t=e.user,r=window.localStorage.getItem("journalData"),n=I(),s=n.loading,i=n.setLoading,c=n.error,o=n.setError,l=Object(a.useState)(!1),b=Object(f.a)(l,2),x=b[0],j=b[1],m=Object(a.useState)(!1),h=Object(f.a)(m,2),O=h[0],w=h[1],p=Object(a.useState)(!1),y=Object(f.a)(p,2),v=y[0],R=y[1],N=Object(a.useState)(r?JSON.parse(r):[]),k=Object(f.a)(N,2),C=k[0],E=k[1],T=Object(a.useState)(!1),M=Object(f.a)(T,2),D=M[0],U=M[1],L=Object(a.useState)(0),Q=Object(f.a)(L,2),F=Q[0],W=Q[1],A=Object(a.useMemo)((function(){var e=C.reduce((function(e,t){return t&&Object.values(t.symbols).forEach((function(t){t.holdingUnitCount>0&&(e[t.instrument.symbol]=!0)})),e}),{});return Object.keys(e)}),[C]),q=Object(a.useMemo)((function(){var e=C.reduce((function(e,t){if(!t)return e;var r=G.DateTime.fromISO(t.date),a=r.startOf("month"),n=r.startOf("week"),s=e.find((function(e){return e.date.equals(a)}));s||(s={date:a,realisedProfitRaw:0,realisedProfitPercent:0,unrealisedProfitRaw:0,unrealisedProfitPercent:0,combinedProfitRaw:0,combinedProfitPercent:0,realisedCost:0,unrealisedCost:0,weekLogs:[]},e.push(s));var i=s.weekLogs.find((function(e){return e.date.equals(n)}));if(!i){for(var c=1,o=a.endOf("week");n>o;)c++,o=o.plus({week:1});i={date:n,weekOfMonth:c,realisedProfitRaw:0,realisedProfitPercent:0,unrealisedProfitRaw:0,unrealisedProfitPercent:0,combinedProfitRaw:0,combinedProfitPercent:0,realisedCost:0,unrealisedCost:0,dayLogs:[]},s.weekLogs.push(i)}return s.realisedCost+=t.realisedCost,s.unrealisedCost+=t.unrealisedCost,s.realisedProfitRaw+=t.realisedProfitRaw,s.unrealisedProfitRaw+=t.unrealisedProfitRaw,s.combinedProfitRaw+=t.realisedProfitRaw+t.unrealisedProfitRaw,s.realisedProfitPercent=0===s.realisedProfitRaw?0:Math.abs(s.realisedProfitRaw)/s.realisedCost*100*(s.realisedProfitRaw<0?-1:1),s.unrealisedProfitPercent=0===s.unrealisedProfitRaw?0:Math.abs(s.unrealisedProfitRaw)/s.unrealisedCost*100*(s.unrealisedProfitRaw<0?-1:1),s.combinedProfitPercent=0===s.combinedProfitRaw?0:Math.abs(s.combinedProfitRaw)/(s.realisedCost+s.unrealisedCost)*100*(s.combinedProfitRaw<0?-1:1),i.realisedCost+=t.realisedCost,i.unrealisedCost+=t.unrealisedCost,i.realisedProfitRaw+=t.realisedProfitRaw,i.unrealisedProfitRaw+=t.unrealisedProfitRaw,i.combinedProfitRaw+=t.realisedProfitRaw+t.unrealisedProfitRaw,i.realisedProfitPercent=0===i.realisedProfitRaw?0:Math.abs(i.realisedProfitRaw)/i.realisedCost*100*(i.realisedProfitRaw<0?-1:1),i.unrealisedProfitPercent=0===i.unrealisedProfitRaw?0:Math.abs(i.unrealisedProfitRaw)/i.unrealisedCost*100*(i.unrealisedProfitRaw<0?-1:1),i.combinedProfitPercent=0===i.combinedProfitRaw?0:Math.abs(i.combinedProfitRaw)/(i.realisedCost+i.unrealisedCost)*100*(i.combinedProfitRaw<0?-1:1),i.dayLogs.push(t),e}),[]);return e.forEach((function(e){e.weekLogs.forEach((function(e){e.dayLogs.reverse()})),e.weekLogs.reverse()})),e.reverse(),e}),[C]);return Object(a.useEffect)((function(){var e=function(){var e=Object(u.a)(d.a.mark((function e(){var r,a,n,s,c,l,u,b,x,j,m,h,O,p;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=G.DateTime.local().startOf("year"),a=window.localStorage.getItem("journalLastFetchDate"),n=a?G.DateTime.fromISO(a):r,s=G.DateTime.local(),c=100,l=0,u=!0,b=C.slice(),x=[],j=[],m=[],i(!0),e.prev=12;case 13:return e.next=15,J(t,n,s,c,l,!0);case 15:h=e.sent,l+=c,j=j.concat(h.filter((function(e){return"SPUR"===e.finTranTypeID}))),m=m.concat(h.filter((function(e){return"SSAL"===e.finTranTypeID}))),h.length<c&&(u=!1);case 20:if(u){e.next=13;break}case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(12),o({title:"Fetching trades failed",message:e.t0.message});case 26:j.sort(te),m.sort(te),b=ne(r,b,j),O=se(b,m),p=Object(f.a)(O,2),b=p[0],x=p[1],b=ie(b,{}),window.localStorage.setItem("journalData",JSON.stringify(b)),window.localStorage.setItem("journalLastFetchDate",s.toISO()),E(b),W(x.length),U(x.length>0),i(!1),w(!0);case 41:case"end":return e.stop()}}),e,null,[[12,23]])})));return function(){return e.apply(this,arguments)}}();x||(j(!0),e())}),[x,C,i,t,o]),Object(a.useEffect)((function(){var e=function(){var e=Object(u.a)(d.a.mark((function e(){var r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(!0),e.prev=1,e.next=4,B(t,A);case 4:r=e.sent,a=r.reduce((function(e,t){return e[t.symbol]=t.lastTrade,e}),{}),E(ie(C,a)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),o({title:"Fetching market data failed",message:e.t0.message});case 12:i(!1);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}();O&&!v&&A.length&&(R(!0),e())}),[C,A,O,v,o,i,t]),Object(g.jsxs)("div",{className:"w-full",children:[Object(g.jsxs)("header",{className:"px-4 py-2 w-full flex items-center",children:[Object(g.jsx)(Y,{children:"".concat(t.firstName,"'s trade journal")}),s&&Object(g.jsx)(S,{className:"ml-2"}),Object(g.jsx)(Z,{className:"ml-auto",to:"/logout",children:"Log out"})]}),Object(g.jsxs)("main",{className:"mt-8 p-4 flex flex-col items-center",children:[Object(g.jsx)("div",{style:{width:400},children:c()}),D&&Object(g.jsx)("div",{style:{width:400},children:Object(g.jsx)(P,{message:"Found ".concat(F," unmatched sell transactions"),dismissable:!0,onDismiss:function(){return U(!1)}})}),Object(g.jsx)("div",{style:{width:1300},children:q.map((function(e){var t=oe(e),r=t.displayRealisedRaw,a=t.displayRealisedPercent,n=t.displayUnrealisedRaw,s=t.displayUnrealisedPercent,i=t.displayCombinedRaw,c=t.displayCombinedPercent;return Object(g.jsxs)("div",{children:[Object(g.jsxs)("div",{className:"flex items-center",children:[Object(g.jsx)(Y,{children:e.date.toFormat("MMMM yyyy")}),Object(g.jsx)("span",{className:"ml-auto flex-shrink-0 text-2xl text-center ".concat(e.realisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:r}),Object(g.jsx)("span",{className:"flex-shrink-0 text-2xl text-center ".concat(e.realisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:a}),Object(g.jsx)("span",{className:"flex-shrink-0 text-2xl text-center ".concat(e.unrealisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:n}),Object(g.jsx)("span",{className:"flex-shrink-0 text-2xl text-center ".concat(e.unrealisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:s}),Object(g.jsx)("span",{className:"flex-shrink-0 text-2xl text-center ".concat(e.combinedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:i}),Object(g.jsx)("span",{className:"flex-shrink-0 text-2xl text-center ".concat(e.combinedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:c})]}),e.weekLogs.map((function(e,t){var r=oe(e),a=r.displayRealisedRaw,n=r.displayRealisedPercent,s=r.displayUnrealisedRaw,i=r.displayUnrealisedPercent,c=r.displayCombinedRaw,o=r.displayCombinedPercent;return Object(g.jsxs)("div",{className:"".concat(0===t?"mt-4":"mt-16"),children:[Object(g.jsxs)("div",{className:"flex items-center",children:[Object(g.jsx)(_,{children:"Week ".concat(e.weekOfMonth)}),Object(g.jsx)("span",{className:"ml-auto flex-shrink-0 text-xl text-center ".concat(e.realisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:a}),Object(g.jsx)("span",{className:"flex-shrink-0 text-xl text-center ".concat(e.realisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:n}),Object(g.jsx)("span",{className:"flex-shrink-0 text-xl text-center ".concat(e.unrealisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:s}),Object(g.jsx)("span",{className:"flex-shrink-0 text-xl text-center ".concat(e.unrealisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:i}),Object(g.jsx)("span",{className:"flex-shrink-0 text-xl text-center ".concat(e.combinedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:c}),Object(g.jsx)("span",{className:"flex-shrink-0 text-xl text-center ".concat(e.combinedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:o})]}),e.dayLogs.map((function(e){if(!e)return null;var t=G.DateTime.fromISO(e.date),r=oe(e),a=r.displayRealisedRaw,n=r.displayRealisedPercent,s=r.displayUnrealisedRaw,i=r.displayUnrealisedPercent,c=r.displayCombinedRaw,o=r.displayCombinedPercent,l=Object.values(e.symbols);return l.sort(ae),Object(g.jsxs)("div",{className:"mt-4 p-2 border border-gray-100 shadow rounded-lg",children:[Object(g.jsxs)("div",{className:"flex items-center",children:[Object(g.jsx)(X,{children:t.toFormat("EEEE")}),Object(g.jsx)("span",{className:"ml-auto text-gray-300",children:t.toFormat("dd/MM")})]}),Object(g.jsxs)("div",{className:"my-3 flex items-center",children:[Object(g.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Code"}),Object(g.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Buy"}),Object(g.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Sell"}),Object(g.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Hold"}),Object(g.jsx)("div",{className:"ml-auto flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Realised ($)"}),Object(g.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Realised (%)"}),Object(g.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Unrealised ($)"}),Object(g.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Unrealised (%)"}),Object(g.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Combined ($)"}),Object(g.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Combined (%)"})]}),l.map((function(e){var t=e.holdingUnitCount>0,r=(e.sells.length,e.realisedProfitRaw,oe(e)),a=r.displayRealisedRaw,n=r.displayRealisedPercent,s=r.displayUnrealisedRaw,i=r.displayUnrealisedPercent,c=r.displayCombinedRaw,o=r.displayCombinedPercent;return Object(g.jsxs)("div",{className:"my-3 flex items-center",children:[Object(g.jsx)("div",{className:"text-center",style:{width:ee},children:e.instrument.symbol}),Object(g.jsx)("div",{className:"flex flex-col",style:{width:ee},children:e.buys.map((function(e,t){return Object(g.jsx)("div",{className:"text-center",children:"".concat(e.unitQuantity," @ $").concat(e.unitPrice.toPrecision(4))},t)}))}),Object(g.jsx)("div",{className:"flex flex-col",style:{width:ee},children:e.sells.map((function(e,t){return Object(g.jsx)("div",{className:"text-center",children:"".concat(e.unitQuantity," @ $").concat(e.unitPrice.toPrecision(4))},t)}))}),Object(g.jsx)("div",{className:"text-center text-yellow-500",style:{width:ee},children:t?"".concat(e.holdingUnitCount):""}),Object(g.jsx)("div",{className:"ml-auto text-center ".concat(e.realisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:a}),Object(g.jsx)("div",{className:"text-center ".concat(e.realisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:n}),Object(g.jsx)("div",{className:"text-center ".concat(e.unrealisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:s}),Object(g.jsx)("div",{className:"text-center ".concat(e.unrealisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:i}),Object(g.jsx)("div",{className:"text-center ".concat(e.combinedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:c}),Object(g.jsx)("div",{className:"text-center ".concat(e.combinedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:o})]},e.instrument.symbol)})),Object(g.jsxs)("div",{className:"py-3 flex items-center border-t border-gray-200",children:[Object(g.jsx)("span",{className:"ml-auto flex-shrink-0 text-lg text-center ".concat(e.realisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:a}),Object(g.jsx)("span",{className:"flex-shrink-0 text-lg text-center ".concat(e.realisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:n}),Object(g.jsx)("span",{className:"flex-shrink-0 text-lg text-center ".concat(e.unrealisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:s}),Object(g.jsx)("span",{className:"flex-shrink-0 text-lg text-center ".concat(e.unrealisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:i}),Object(g.jsx)("span",{className:"flex-shrink-0 text-lg text-center ".concat(e.combinedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:c}),Object(g.jsx)("span",{className:"flex-shrink-0 text-lg text-center ".concat(e.combinedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:o})]})]},e.date)}))]},e.date.toISO())}))]},e.date.toISO())}))})]})]})},de=Object(o.i)((function(){var e=Object(o.h)(),t=function(){var e=window.localStorage.getItem("user");return e?JSON.parse(e):null}(),r=[Object(g.jsx)(o.b,{path:"/login",exact:!0,component:z},"/login"),Object(g.jsx)(o.a,{to:"/login"},"redirect/login")],a=[Object(g.jsx)(o.b,{path:"/journal",exact:!0,children:Object(g.jsx)(le,{user:t})},"/journal"),Object(g.jsx)(o.b,{path:"/logout",exact:!0,children:Object(g.jsx)(H,{user:t})},"/logout"),Object(g.jsx)(o.a,{to:"/journal"},"redirect/journal")];return Object(g.jsx)(o.d,{location:e,children:t?a:r})}));i.a.render(Object(g.jsx)(c.a,{children:Object(g.jsx)(n.a.StrictMode,{children:Object(g.jsx)(de,{})})}),document.getElementById("root"))}},[[70,1,2]]]);
//# sourceMappingURL=main.72dbaa0f.chunk.js.map