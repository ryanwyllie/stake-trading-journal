(this["webpackJsonpstake-trading-journal"]=this["webpackJsonpstake-trading-journal"]||[]).push([[0],{43:function(e,t,r){},70:function(e,t,r){"use strict";r.r(t);var a=r(0),n=r.n(a),s=r(34),i=r.n(s),c=r(15),l=(r(43),r(5)),o=r(3),d=r.n(o),u=r(6),f=r(4),x=r(20),b=r(36),h=r(21),j=r.n(h),m=r(2),O=r(8),w=r(73),y=r(72),g=function(e,t){var r=t.split(" ").reduce((function(e,t){var r=t.split("-").slice(0,-1).join("-");return""!==r&&e.push(r),e}),[]),a=e.split(" ").filter((function(e){return!r.some((function(t){return e.startsWith(t)}))})).join(" ");return"".concat(a," ").concat(t)};var p=r(1),v=function(e){var t=e.title,r=void 0===t?null:t,a=e.icon,n=void 0===a?null:a,s=e.className,i=void 0===s?"":s,c=e.closeButtonClassName,l=void 0===c?"":c,o=e.dismissable,d=void 0!==o&&o,u=e.onDismiss,f=void 0===u?null:u,x=e.message;return Object(p.jsxs)("div",{className:g("relative flex items-center rounded-lg py-2 px-4",i),role:"alert",children:[d&&f&&Object(p.jsx)("button",{className:g("absolute top-0 right-0 rounded-full p-1 m-1 transform ease-in-out duration-300",l),type:"button",title:"Close",onClick:function(){return f()},children:Object(p.jsx)(y.a,{className:"w-4 h-4"})}),n&&Object(p.jsx)("div",{className:"mr-4 flex-shrink-0",style:{width:"30px",height:"30px"},children:n}),Object(p.jsxs)("div",{children:[r&&Object(p.jsx)("h3",{className:"font-bold mb-1",children:r}),Object(p.jsx)("p",{children:x})]})]})},P=function(e){var t=e.className,r=void 0===t?"":t,a=Object(O.a)(e,["className"]);return Object(p.jsx)(v,Object(m.a)({className:g("bg-red-200 text-red-900",r),closeButtonClassName:"text-red-900 hover:bg-red-300 focus:bg-red-300",icon:Object(p.jsx)(w.a,{})},a))};function N(){return(N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function R(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)r=s[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)r=s[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function k(e,t){var r=e.title,n=e.titleId,s=R(e,["title","titleId"]);return a.createElement("svg",N({xmlns:"http://www.w3.org/2000/svg",fill:"none",height:24,width:24,viewBox:"0 0 24 24",ref:t,"aria-labelledby":n},s),r?a.createElement("title",{id:n},r):null,a.createElement("circle",{cx:12,cy:12,r:10,stroke:"currentColor",strokeWidth:4,style:{opacity:.25}}),a.createElement("path",{fill:"currentColor",style:{opacity:.75},d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"}))}var S=a.forwardRef(k),C=(r.p,function(e){var t=e.className,r=void 0===t?"":t,a=Object(O.a)(e,["className"]);return Object(p.jsx)(S,Object(m.a)({className:g("animate-spin",r)},a))}),I=function(e){var t=(e||{}).defaultLoading,r=void 0!==t&&t,n=Object(a.useState)(r),s=Object(f.a)(n,2),i=s[0],c=s[1],l=function(){var e=Object(a.useState)(null),t=Object(f.a)(e,2),r=t[0],n=t[1],s=function(){return n(null)};return{error:function(e){var t=e||{},a=t.className,n=void 0===a?"":a,i=t.dismissable,c=void 0===i||i;return r?Object(p.jsx)(P,{className:n,title:r.title,message:r.message,dismissable:c,onDismiss:s}):null},set:n,clear:s,has:function(){return null!==r}}}(),o=l.error,d=l.set,u=l.clear,x=l.has;return{loading:i,loadingText:function(e){return i?Object(p.jsxs)("div",{className:"flex items-center",children:[Object(p.jsx)(C,{className:"mr-2"}),Object(p.jsx)("span",{children:e.loading})]}):e.default},setLoading:c,error:o,setError:d,clearError:u,hasError:x}},E=function(e){var t=e.className,r=void 0===t?"":t,a=e.children,n=Object(O.a)(e,["className","children"]);return Object(p.jsx)("h1",Object(m.a)(Object(m.a)({className:g("font-heading font-bold text-5xl text-black",r)},n),{},{children:a}))},M=r(37),U=r(7);var T=Object(a.forwardRef)((function(e,t){var r=e.className,n=void 0===r?"":r,s=e.id,i=void 0===s?Object(M.a)():s,c=e.error,l=void 0!==c&&c,o=e.debounceOnChange,d=void 0===o?void 0:o,u=e.debounceTimeout,x=void 0===u?500:u,b=e.value,h=e.onChange,j=Object(O.a)(e,["className","id","error","debounceOnChange","debounceTimeout","value","onChange"]),w=Object(a.useState)(void 0===b?"":b),y=Object(f.a)(w,2),v=y[0],P=y[1],N=Object(a.useMemo)((function(){return function(e,t){var r=null,a=0,n=void 0,s=function s(){var i=Date.now()-a;i>t?(e.apply(void 0,Object(U.a)(n)),r=null,a=0,n=void 0):r=window.setTimeout(s,t-i)};return function(){null===r&&(r=window.setTimeout(s,t));for(var e=arguments.length,i=new Array(e),c=0;c<e;c++)i[c]=arguments[c];n=i,a=Date.now()}}((function(e){d&&d(e)}),x)}),[d,x]);return Object(p.jsx)("input",Object(m.a)({ref:t,id:i,className:g("py-3 px-4 w-full rounded-lg default-transition border-2 focus:border-black ".concat(l?"border-red-500":"border-gray-300"),n),value:d?v:b,onChange:d?function(e){P(e.target.value),N(e.target.value)}:h},j))})),D=Object(a.forwardRef)((function(e,t){var r=e.children,a=e.className,n=void 0===a?"":a,s=e.type,i=void 0===s?"button":s,c=Object(O.a)(e,["children","className","type"]);return Object(p.jsx)("button",Object(m.a)(Object(m.a)({ref:t,type:i,className:g("py-3 px-4 flex items-center justify-center rounded-lg font-bold default-transition",n)},c),{},{children:r}))})),L=Object(a.forwardRef)((function(e,t){var r=e.className,a=void 0===r?"":r,n=Object(O.a)(e,["className"]);return Object(p.jsx)(D,Object(m.a)({ref:t,className:g("bg-black text-white hover:ring-4 hover:ring-gray-200 focus:ring-4 focus:ring-gray-200",a)},n))}));function H(e){return"".concat("https://global-prd-api.hellostake.com/api","/").concat(e)}function B(e,t,r){return F.apply(this,arguments)}function F(){return(F=Object(u.a)(d.a.mark((function e(t,r,a){var n,s,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={username:t,password:r,platformType:"WEB_f5K2x3",rememberMeDays:30},a&&(n.otp=a),e.next=4,fetch(H("sessions/v2/createSession"),{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(n)});case 4:if(!(s=e.sent).ok){e.next=12;break}return e.next=8,s.json();case 8:return i=e.sent,e.abrupt("return",{firstName:i.firstName,lastName:i.lastName,regionIdentifier:i.regionIdentifier,sessionKey:i.sessionKey,userID:i.userID,username:i.username});case 12:if(412!==s.status){e.next=16;break}return e.abrupt("return",null);case 16:return e.next=18,s.json();case 18:throw c=e.sent,new Error("Failed to login: ".concat(c.message));case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(){return(Q=Object(u.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(H("userauth/".concat(t.sessionKey)),{method:"DELETE",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer"});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t,r,a,n,s){return W.apply(this,arguments)}function W(){return(W=Object(u.a)(d.a.mark((function e(t,r,a,n,s,i){var c,l,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(H("users/accounts/accountTransactions"),{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json","Stake-Session-Token":t.sessionKey},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify({direction:i?"prev":"next",from:r.toISO(),to:a.toISO(),limit:n,offset:s||null})});case 2:if(!(c=e.sent).ok){e.next=10;break}return e.next=6,c.json();case 6:return l=e.sent,e.abrupt("return",l);case 10:return e.next=12,c.json();case 12:throw o=e.sent,new Error("Failed to load transactions: ".concat(o.message));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t){return J.apply(this,arguments)}function J(){return(J=Object(u.a)(d.a.mark((function e(t,r){var a,n,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(H("quotes/marketData/".concat(r.join(","))),{method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json","Stake-Session-Token":t.sessionKey},redirect:"follow",referrerPolicy:"no-referrer"});case 2:if(!(a=e.sent).ok){e.next=10;break}return e.next=6,a.json();case 6:return n=e.sent,e.abrupt("return",n.marketDataList);case 10:return e.next=12,a.json();case 12:throw s=e.sent,new Error("Failed to load market data: ".concat(s.message));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var q=j.a.object({email:j.a.string().required().email({tlds:!1}),password:j.a.string().required(),otp:j.a.string()}),K=function(){var e=Object(l.g)(),t=Object(a.useState)(!1),r=Object(f.a)(t,2),n=r[0],s=r[1],i=Object(a.useRef)(null),c=Object(x.c)({criteriaMode:"all",resolver:Object(b.joiResolver)(q)}),o=c.register,h=c.errors,j=(c.formState,c.handleSubmit),m=I(),O=m.loading,w=m.loadingText,y=m.setLoading,g=m.error,v=m.setError,P=m.clearError;Object(a.useEffect)((function(){i&&i.current&&i.current.focus()}),[]);var N=function(){var t=Object(u.a)(d.a.mark((function t(r){var a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n||r.otp){t.next=3;break}return v({title:"MFA Required",message:"You need to supply the verifcation code"}),t.abrupt("return");case 3:return P(),y(!0),t.prev=5,t.next=8,B(r.email,r.password,r.otp?r.otp:void 0);case 8:null===(a=t.sent)?(s(!0),y(!1)):(window.localStorage.setItem("user",JSON.stringify(a)),e.push("/")),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(5),v({title:"Login failed",message:t.t0.message}),y(!1);case 16:case"end":return t.stop()}}),t,null,[[5,12]])})));return function(e){return t.apply(this,arguments)}}();return Object(p.jsxs)("div",{className:"flex flex-col items-center w-screen h-screen pt-20",children:[Object(p.jsx)(E,{children:"Stake trading journal"}),g({className:"mt-4"}),Object(p.jsxs)("form",{className:"mt-12",onSubmit:j(N),style:{width:400},children:[Object(p.jsx)(T,{ref:function(e){o(e),i.current=e},name:"email",type:"text",error:!!h.email,placeholder:"Email"}),Object(p.jsx)(T,{ref:o,className:"mt-2",type:"password",name:"password",error:!!h.password,placeholder:"Password"}),n&&Object(p.jsx)(T,{ref:o,className:"mt-2",name:"otp",error:!!h.password,placeholder:"Verification code"}),Object(p.jsx)(L,{className:"mt-6 w-full text-xl text-white",type:"submit",disabled:O,children:w({loading:"Logging in...",default:"Log in"})})]})]})},z=function(e){var t=e.user,r=Object(l.g)();return Object(a.useEffect)((function(){!function(e){Q.apply(this,arguments)}(t),window.localStorage.removeItem("user"),window.localStorage.removeItem("journalData"),window.localStorage.removeItem("journalLastFetchDate"),r.push("/login")}),[]),null},V=r(10),G=r(17),Y=function(e){var t=e.className,r=void 0===t?"":t,a=e.children,n=Object(O.a)(e,["className","children"]);return Object(p.jsx)("h2",Object(m.a)(Object(m.a)({className:g("font-heading font-bold text-4xl text-black",r)},n),{},{children:a}))},_=function(e){var t=e.className,r=void 0===t?"":t,a=e.children,n=Object(O.a)(e,["className","children"]);return Object(p.jsx)("h3",Object(m.a)(Object(m.a)({className:g("font-heading font-bold text-3xl text-black",r)},n),{},{children:a}))},X=function(e){var t=e.className,r=void 0===t?"":t,a=e.children,n=Object(O.a)(e,["className","children"]);return Object(p.jsx)("h4",Object(m.a)(Object(m.a)({className:g("font-heading font-bold text-2xl text-black",r)},n),{},{children:a}))},Z=function(e){var t=e.className,r=void 0===t?"":t,a=Object(O.a)(e,["className"]);return Object(p.jsx)(c.b,Object(m.a)({className:g("font-bold underline default-transition",r)},a))},ee=125,te=140;function re(e,t){return e.tranWhen<t.tranWhen?-1:e.tranWhen>t.tranWhen?1:0}function ae(e,t){return e.date<t.date?-1:e.date>t.date?1:0}function ne(e,t){var r=e.buys[0].date,a=t.buys[0].date;return r<a?-1:r>a?1:0}function se(e,t,r){var a=t.slice();return r.forEach((function(t){if("SPUR"===t.finTranTypeID){var r=t.instrument.symbol,n=G.DateTime.fromISO(t.tranWhen),s=Math.floor(n.diff(e).as("days")),i=a[s];i||(i={symbols:{},realisedProfitRaw:0,realisedProfitPercent:0,unrealisedProfitRaw:0,unrealisedProfitPercent:0,combinedProfitRaw:0,combinedProfitPercent:0,realisedCost:0,unrealisedCost:0,date:n.startOf("day").toISO(),hasHoldings:!1,hasSells:!1,startingAccountBalance:t.accountBalance-t.accountAmount});var c=i.symbols[r];c||(c={instrument:t.instrument,buys:[],sells:[],holdingUnitCount:0,realisedProfitRaw:0,realisedProfitPercent:0,unrealisedProfitRaw:0,unrealisedProfitPercent:0,combinedProfitRaw:0,combinedProfitPercent:0,realisedCost:0,unrealisedCost:0});var l=c.buys.findIndex((function(e){return e.orderId===t.orderID}));if(l>=0){var o=c.buys[l];c.buys[l]=Object(m.a)(Object(m.a)({},o),{},{unitQuantity:o.unitQuantity+t.fillQty,totalPrice:o.totalPrice+t.tranAmount})}else c.buys=c.buys.concat({orderId:t.orderID,unitPrice:t.fillPx,unitQuantity:t.fillQty,totalPrice:t.tranAmount,date:t.tranWhen});c.holdingUnitCount+=t.fillQty,i.symbols=Object(m.a)(Object(m.a)({},i.symbols),{},Object(V.a)({},r,Object(m.a)({},c))),a[s]=Object(m.a)({},i)}})),a}function ie(e,t){var r=e.slice(),a=[];return t.forEach((function(e){if("SSAL"===e.finTranTypeID){for(var t=e.instrument.symbol,n=e.fillQty,s=0;n>0&&s<r.length;){var i=r[s],c=i?i.symbols[t]:void 0;if(c&&c.holdingUnitCount>=0){var l=c.holdingUnitCount>=n?n:n-c.holdingUnitCount;r[s]=Object(m.a)(Object(m.a)({},r[s]),{},{symbols:Object(m.a)(Object(m.a)({},r[s].symbols),{},Object(V.a)({},t,Object(m.a)(Object(m.a)({},c),{},{holdingUnitCount:c.holdingUnitCount-l,sells:c.sells.concat({orderId:e.orderID,unitPrice:e.fillPx,unitQuantity:l,totalPrice:e.tranAmount,date:e.tranWhen})})))}),n-=l}s++}n>0&&a.push(Object(m.a)(Object(m.a)({},e),{},{fillQty:n}))}})),[r,a]}function ce(e,t){return e.map((function(e){if(!e)return null;var r=0,a=0,n=0,s=0,i=!1,c=!1,l=Object.keys(e.symbols).reduce((function(l,o){var d=e.symbols[o],u=0;d.sells.sort(ae),d.buys.sort(ae);var x=d.sells.reduce((function(e,t){return u+=t.unitQuantity,e+t.unitQuantity*t.unitPrice}),0),b=d.buys.reduce((function(e,t){var r=t.unitQuantity;return u>0&&(r>u?(e[0]=e[0]+u*t.unitPrice,r-=u,u=0):(e[0]=e[0]+r*t.unitPrice,u-=r,r=0)),r>0&&(e[1]=e[1]+r*t.unitPrice),e}),[0,0]),h=Object(f.a)(b,2),j=h[0],O=h[1],w=x-j,y=0===w?0:Math.abs(w)/j*100*(w<0?-1:1),g=t[o]||0,p=d.holdingUnitCount*g,v=g&&d.holdingUnitCount?p-O:0,P=0===v?0:Math.abs(v)/O*100*(v<0?-1:1),N=x+p-(j+O),R=0===N?0:Math.abs(w+v)/(j+O)*100*(N<0?-1:1);return r+=j,a+=x,n+=O,s+=p,i=i||d.holdingUnitCount>0,c=c||d.sells.length>0,l[o]=Object(m.a)(Object(m.a)({},d),{},{realisedProfitRaw:w,realisedProfitPercent:y,unrealisedProfitRaw:v,unrealisedProfitPercent:P,combinedProfitRaw:N,combinedProfitPercent:R,realisedCost:j,unrealisedCost:O}),l}),{}),o=a-r,d=0===o?0:Math.abs(o)/r*100*(o<0?-1:1),u=s-n,x=0===u?0:Math.abs(u)/n*100*(u<0?-1:1),b=a+s-(r+n),h=0===b?0:Math.abs(o+u)/(r+n)*100*(b<0?-1:1);return Object(m.a)(Object(m.a)({},e),{},{symbols:l,realisedProfitRaw:o,realisedProfitPercent:d,unrealisedProfitRaw:u,unrealisedProfitPercent:x,combinedProfitRaw:b,combinedProfitPercent:h,realisedCost:r,unrealisedCost:n,hasHoldings:i,hasSells:c})}))}function le(e,t){var r=e>=0;return["".concat(r?"+":"-","$").concat(Math.abs(e).toPrecision(3)),"".concat(r?"+":"-").concat(Math.abs(t).toPrecision(3),"%")]}function oe(e){var t=le(e.realisedProfitRaw,e.realisedProfitPercent),r=Object(f.a)(t,2),a=r[0],n=r[1],s=le(e.unrealisedProfitRaw,e.unrealisedProfitPercent),i=Object(f.a)(s,2),c=i[0],l=i[1],o=le(e.combinedProfitRaw,e.combinedProfitPercent),d=Object(f.a)(o,2);return{displayRealisedRaw:a,displayRealisedPercent:n,displayUnrealisedRaw:c,displayUnrealisedPercent:l,displayCombinedRaw:d[0],displayCombinedPercent:d[1]}}var de=function(e){var t=e.user,r=window.localStorage.getItem("journalData"),n=I(),s=n.loading,i=n.setLoading,c=n.error,l=n.setError,o=Object(a.useState)(!1),x=Object(f.a)(o,2),b=x[0],h=x[1],j=Object(a.useState)(!1),m=Object(f.a)(j,2),O=m[0],w=m[1],y=Object(a.useState)(!1),g=Object(f.a)(y,2),v=g[0],N=g[1],R=Object(a.useState)(r?JSON.parse(r):[]),k=Object(f.a)(R,2),S=k[0],E=k[1],M=Object(a.useState)(!1),U=Object(f.a)(M,2),T=U[0],D=U[1],L=Object(a.useState)(0),H=Object(f.a)(L,2),B=H[0],F=H[1],Q=Object(a.useMemo)((function(){var e=S.reduce((function(e,t){return t&&Object.values(t.symbols).forEach((function(t){t.holdingUnitCount>0&&(e[t.instrument.symbol]=!0)})),e}),{});return Object.keys(e)}),[S]),W=Object(a.useMemo)((function(){var e=S.reduce((function(e,t){if(!t)return e;var r=G.DateTime.fromISO(t.date),a=r.startOf("month"),n=r.startOf("week"),s=e.find((function(e){return e.date.equals(a)}));s||(s={date:a,realisedProfitRaw:0,realisedProfitPercent:0,unrealisedProfitRaw:0,unrealisedProfitPercent:0,combinedProfitRaw:0,combinedProfitPercent:0,realisedCost:0,unrealisedCost:0,weekLogs:[],hasHoldings:!1,hasSells:!1},e.push(s));var i=s.weekLogs.find((function(e){return e.date.equals(n)}));if(!i){for(var c=1,l=a.endOf("week");n>l;)c++,l=l.plus({week:1});i={date:n,weekOfMonth:c,realisedProfitRaw:0,realisedProfitPercent:0,unrealisedProfitRaw:0,unrealisedProfitPercent:0,combinedProfitRaw:0,combinedProfitPercent:0,realisedCost:0,unrealisedCost:0,dayLogs:[],hasHoldings:!1,hasSells:!1},s.weekLogs.push(i)}return s.hasHoldings=s.hasHoldings||t.hasHoldings,s.hasSells=s.hasSells||t.hasSells,s.realisedCost+=t.realisedCost,s.unrealisedCost+=t.unrealisedCost,s.realisedProfitRaw+=t.realisedProfitRaw,s.unrealisedProfitRaw+=t.unrealisedProfitRaw,s.combinedProfitRaw+=t.realisedProfitRaw+t.unrealisedProfitRaw,s.realisedProfitPercent=0===s.realisedProfitRaw?0:Math.abs(s.realisedProfitRaw)/s.realisedCost*100*(s.realisedProfitRaw<0?-1:1),s.unrealisedProfitPercent=0===s.unrealisedProfitRaw?0:Math.abs(s.unrealisedProfitRaw)/s.unrealisedCost*100*(s.unrealisedProfitRaw<0?-1:1),s.combinedProfitPercent=0===s.combinedProfitRaw?0:Math.abs(s.combinedProfitRaw)/(s.realisedCost+s.unrealisedCost)*100*(s.combinedProfitRaw<0?-1:1),i.hasHoldings=i.hasHoldings||t.hasHoldings,i.hasSells=i.hasSells||t.hasSells,i.realisedCost+=t.realisedCost,i.unrealisedCost+=t.unrealisedCost,i.realisedProfitRaw+=t.realisedProfitRaw,i.unrealisedProfitRaw+=t.unrealisedProfitRaw,i.combinedProfitRaw+=t.realisedProfitRaw+t.unrealisedProfitRaw,i.realisedProfitPercent=0===i.realisedProfitRaw?0:Math.abs(i.realisedProfitRaw)/i.realisedCost*100*(i.realisedProfitRaw<0?-1:1),i.unrealisedProfitPercent=0===i.unrealisedProfitRaw?0:Math.abs(i.unrealisedProfitRaw)/i.unrealisedCost*100*(i.unrealisedProfitRaw<0?-1:1),i.combinedProfitPercent=0===i.combinedProfitRaw?0:Math.abs(i.combinedProfitRaw)/(i.realisedCost+i.unrealisedCost)*100*(i.combinedProfitRaw<0?-1:1),i.dayLogs.push(t),e}),[]);return e.forEach((function(e){e.weekLogs.forEach((function(e){e.dayLogs.reverse()})),e.weekLogs.reverse()})),e.reverse(),e}),[S]),J=Object(a.useMemo)((function(){var e=0,t=S.reduce((function(t,r){return r&&(e||(e=r.startingAccountBalance,t[0]=e,t[1]=e),t[0]+=r.realisedProfitRaw,t[1]+=r.combinedProfitRaw),t}),[0,0]),r=Object(f.a)(t,2),a=r[0],n=r[1],s=a-e,i=0===s?0:Math.abs(s)/e*100*(s>=0?1:-1),c=s>=0,l=n-e,o=0===l?0:Math.abs(l)/e*100*(l>=0?1:-1),d=l>=0,u=le(s,i),x=Object(f.a)(u,2),b=x[0],h=x[1],j=le(l,o),m=Object(f.a)(j,2),O=m[0],w=m[1];return{startingBalance:"$".concat(e),isRealisedProfit:c,realisedBalance:"$".concat(a.toFixed(2)),realisedProfitRaw:b,realisedProfitPercent:h,isUnrealisedProfit:d,unrealisedBalance:"$".concat(n.toFixed(2)),unrealisedProfitRaw:O,unrealisedProfitPercent:w}}),[S]);return Object(a.useEffect)((function(){var e=function(){var e=Object(u.a)(d.a.mark((function e(){var r,a,n,s,c,o,u,x,b,h,j,m,O,y;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=G.DateTime.local().startOf("year"),a=window.localStorage.getItem("journalLastFetchDate"),n=a?G.DateTime.fromISO(a):r,s=G.DateTime.local(),c=100,o=0,u=!0,x=S.slice(),b=[],h=[],j=[],i(!0),e.prev=12;case 13:return e.next=15,A(t,n,s,c,o,!0);case 15:m=e.sent,o+=c,h=h.concat(m.filter((function(e){return"SPUR"===e.finTranTypeID}))),j=j.concat(m.filter((function(e){return"SSAL"===e.finTranTypeID}))),m.length<c&&(u=!1);case 20:if(u){e.next=13;break}case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(12),l({title:"Fetching trades failed",message:e.t0.message});case 26:h.sort(re),j.sort(re),x=se(r,x,h),O=ie(x,j),y=Object(f.a)(O,2),x=y[0],b=y[1],x=ce(x,{}),window.localStorage.setItem("journalData",JSON.stringify(x)),window.localStorage.setItem("journalLastFetchDate",s.toISO()),E(x),F(b.length),D(b.length>0),i(!1),w(!0);case 41:case"end":return e.stop()}}),e,null,[[12,23]])})));return function(){return e.apply(this,arguments)}}();b||(h(!0),e())}),[b,S,i,t,l]),Object(a.useEffect)((function(){var e=function(){var e=Object(u.a)(d.a.mark((function e(){var r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(!0),e.prev=1,e.next=4,$(t,Q);case 4:r=e.sent,a=r.reduce((function(e,t){return e[t.symbol]=t.lastTrade,e}),{}),E(ce(S,a)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),l({title:"Fetching market data failed",message:e.t0.message});case 12:i(!1);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}();O&&!v&&Q.length&&(N(!0),e())}),[S,Q,O,v,l,i,t]),Object(p.jsxs)("div",{className:"w-full",children:[Object(p.jsxs)("header",{className:"px-4 py-2 w-full flex items-center",children:[Object(p.jsx)(Y,{children:"".concat(t.firstName,"'s trade journal")}),s&&Object(p.jsx)(C,{className:"ml-2"}),Object(p.jsx)(Z,{className:"ml-auto",to:"/logout",children:"Log out"})]}),Object(p.jsxs)("main",{className:"mt-8 p-4 flex flex-col items-center",children:[Object(p.jsx)("div",{style:{width:400},children:c()}),T&&Object(p.jsx)("div",{style:{width:400},children:Object(p.jsx)(P,{message:"Found ".concat(B," unmatched sell transactions"),dismissable:!0,onDismiss:function(){return D(!1)}})}),Object(p.jsxs)("div",{style:{width:1300},children:[Object(p.jsxs)("div",{children:[Object(p.jsx)(Y,{children:"Account summary"}),Object(p.jsxs)("div",{className:"mt-2 px-2 py-5 border border-gray-100 shadow rounded-lg flex justify-between",children:[Object(p.jsxs)("div",{className:"flex-shrink-0 text-center",style:{width:te},children:[Object(p.jsx)("div",{className:"text-gray-300",children:"Starting balance"}),Object(p.jsx)("div",{className:"my-3",children:J.startingBalance})]}),Object(p.jsxs)("div",{className:"flex-shrink-0 text-center",style:{width:te},children:[Object(p.jsx)("div",{className:"text-gray-300",children:"Realised balance"}),Object(p.jsx)("div",{className:"my-3 ".concat(J.isRealisedProfit?"text-green-500":"text-red-500"),children:J.realisedBalance})]}),Object(p.jsxs)("div",{className:"flex-shrink-0 text-center",style:{width:te},children:[Object(p.jsx)("div",{className:"text-gray-300",children:"Realised ($)"}),Object(p.jsx)("div",{className:"my-3 ".concat(J.isRealisedProfit?"text-green-500":"text-red-500"),children:J.realisedProfitRaw})]}),Object(p.jsxs)("div",{className:"flex-shrink-0 text-center",style:{width:te},children:[Object(p.jsx)("div",{className:"text-gray-300",children:"Realised (%)"}),Object(p.jsx)("div",{className:"my-3 ".concat(J.isRealisedProfit?"text-green-500":"text-red-500"),children:J.realisedProfitPercent})]}),Object(p.jsxs)("div",{className:"flex-shrink-0 text-center",style:{width:te},children:[Object(p.jsx)("div",{className:"text-gray-300",children:"Unrealised balance"}),Object(p.jsx)("div",{className:"my-3 ".concat(J.isUnrealisedProfit?"text-green-500":"text-red-500"),children:J.unrealisedBalance})]}),Object(p.jsxs)("div",{className:"flex-shrink-0 text-center",style:{width:te},children:[Object(p.jsx)("div",{className:"text-gray-300",children:"Unrealised ($)"}),Object(p.jsx)("div",{className:"my-3 ".concat(J.isUnrealisedProfit?"text-green-500":"text-red-500"),children:J.unrealisedProfitRaw})]}),Object(p.jsxs)("div",{className:"flex-shrink-0 text-center",style:{width:te},children:[Object(p.jsx)("div",{className:"text-gray-300",children:"Unrealised (%)"}),Object(p.jsx)("div",{className:"my-3 ".concat(J.isUnrealisedProfit?"text-green-500":"text-red-500"),children:J.unrealisedProfitPercent})]})]})]}),W.map((function(e){var t=oe(e),r=t.displayRealisedRaw,a=t.displayRealisedPercent,n=t.displayUnrealisedRaw,s=t.displayUnrealisedPercent,i=t.displayCombinedRaw,c=t.displayCombinedPercent;return Object(p.jsxs)("div",{className:"mt-8",children:[Object(p.jsxs)("div",{className:"flex items-center",children:[Object(p.jsx)(Y,{children:e.date.toFormat("MMMM yyyy")}),Object(p.jsx)("span",{className:"ml-auto flex-shrink-0 text-2xl text-center ".concat(e.realisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:e.hasSells?r:""}),Object(p.jsx)("span",{className:"flex-shrink-0 text-2xl text-center ".concat(e.realisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:e.hasSells?a:""}),Object(p.jsx)("span",{className:"flex-shrink-0 text-2xl text-center ".concat(e.unrealisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:e.hasHoldings?n:""}),Object(p.jsx)("span",{className:"flex-shrink-0 text-2xl text-center ".concat(e.unrealisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:e.hasHoldings?s:""}),Object(p.jsx)("span",{className:"flex-shrink-0 text-2xl text-center ".concat(e.combinedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:i}),Object(p.jsx)("span",{className:"flex-shrink-0 text-2xl text-center ".concat(e.combinedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:c})]}),e.weekLogs.map((function(e,t){var r=oe(e),a=r.displayRealisedRaw,n=r.displayRealisedPercent,s=r.displayUnrealisedRaw,i=r.displayUnrealisedPercent,c=r.displayCombinedRaw,l=r.displayCombinedPercent;return Object(p.jsxs)("div",{className:"".concat(0===t?"mt-4":"mt-16"),children:[Object(p.jsxs)("div",{className:"flex items-center",children:[Object(p.jsx)(_,{children:"Week ".concat(e.weekOfMonth)}),Object(p.jsx)("span",{className:"ml-auto flex-shrink-0 text-xl text-center ".concat(e.realisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:e.hasSells?a:""}),Object(p.jsx)("span",{className:"flex-shrink-0 text-xl text-center ".concat(e.realisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:e.hasSells?n:""}),Object(p.jsx)("span",{className:"flex-shrink-0 text-xl text-center ".concat(e.unrealisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:e.hasHoldings?s:""}),Object(p.jsx)("span",{className:"flex-shrink-0 text-xl text-center ".concat(e.unrealisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:e.hasHoldings?i:""}),Object(p.jsx)("span",{className:"flex-shrink-0 text-xl text-center ".concat(e.combinedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:c}),Object(p.jsx)("span",{className:"flex-shrink-0 text-xl text-center ".concat(e.combinedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:l})]}),e.dayLogs.map((function(e){if(!e)return null;var t=G.DateTime.fromISO(e.date),r=oe(e),a=r.displayRealisedRaw,n=r.displayRealisedPercent,s=r.displayUnrealisedRaw,i=r.displayUnrealisedPercent,c=r.displayCombinedRaw,l=r.displayCombinedPercent,o=Object.values(e.symbols);return o.sort(ne),Object(p.jsxs)("div",{className:"mt-4 p-2 border border-gray-100 shadow rounded-lg",children:[Object(p.jsxs)("div",{className:"flex items-center",children:[Object(p.jsx)(X,{children:t.toFormat("EEEE")}),Object(p.jsx)("span",{className:"ml-auto text-gray-300",children:t.toFormat("dd/MM")})]}),Object(p.jsxs)("div",{className:"my-3 flex items-center",children:[Object(p.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Code"}),Object(p.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Buy"}),Object(p.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Sell"}),Object(p.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Hold"}),Object(p.jsx)("div",{className:"ml-auto flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Realised ($)"}),Object(p.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Realised (%)"}),Object(p.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Unrealised ($)"}),Object(p.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Unrealised (%)"}),Object(p.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Combined ($)"}),Object(p.jsx)("div",{className:"flex-shrink-0 text-center text-gray-300",style:{width:ee},children:"Combined (%)"})]}),o.map((function(e){var t=e.holdingUnitCount>0,r=e.sells.length>0,a=oe(e),n=a.displayRealisedRaw,s=a.displayRealisedPercent,i=a.displayUnrealisedRaw,c=a.displayUnrealisedPercent,l=a.displayCombinedRaw,o=a.displayCombinedPercent;return Object(p.jsxs)("div",{className:"my-3 flex items-center",children:[Object(p.jsx)("div",{className:"text-center",style:{width:ee},children:e.instrument.symbol}),Object(p.jsx)("div",{className:"flex flex-col",style:{width:ee},children:e.buys.map((function(e,t){return Object(p.jsx)("div",{className:"text-center",children:"".concat(e.unitQuantity," @ $").concat(e.unitPrice.toPrecision(4))},t)}))}),Object(p.jsx)("div",{className:"flex flex-col",style:{width:ee},children:e.sells.map((function(e,t){return Object(p.jsx)("div",{className:"text-center",children:"".concat(e.unitQuantity," @ $").concat(e.unitPrice.toPrecision(4))},t)}))}),Object(p.jsx)("div",{className:"text-center text-yellow-500",style:{width:ee},children:t?"".concat(e.holdingUnitCount):""}),Object(p.jsx)("div",{className:"ml-auto text-center ".concat(e.realisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:r?n:""}),Object(p.jsx)("div",{className:"text-center ".concat(e.realisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:r?s:""}),Object(p.jsx)("div",{className:"text-center ".concat(e.unrealisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:t?i:""}),Object(p.jsx)("div",{className:"text-center ".concat(e.unrealisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:t?c:""}),Object(p.jsx)("div",{className:"text-center ".concat(e.combinedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:l}),Object(p.jsx)("div",{className:"text-center ".concat(e.combinedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:o})]},e.instrument.symbol)})),Object(p.jsxs)("div",{className:"py-3 flex items-center border-t border-gray-200",children:[Object(p.jsx)("span",{className:"ml-auto flex-shrink-0 text-lg text-center ".concat(e.realisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:e.hasSells?a:""}),Object(p.jsx)("span",{className:"flex-shrink-0 text-lg text-center ".concat(e.realisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:e.hasSells?n:""}),Object(p.jsx)("span",{className:"flex-shrink-0 text-lg text-center ".concat(e.unrealisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:e.hasHoldings?s:""}),Object(p.jsx)("span",{className:"flex-shrink-0 text-lg text-center ".concat(e.unrealisedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:e.hasHoldings?i:""}),Object(p.jsx)("span",{className:"flex-shrink-0 text-lg text-center ".concat(e.combinedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:c}),Object(p.jsx)("span",{className:"flex-shrink-0 text-lg text-center ".concat(e.combinedProfitRaw>=0?"text-green-500":"text-red-500"),style:{width:ee},children:l})]})]},e.date)}))]},e.date.toISO())}))]},e.date.toISO())}))]})]})]})},ue=Object(l.i)((function(){var e=Object(l.h)(),t=function(){var e=window.localStorage.getItem("user");return e?JSON.parse(e):null}(),r=[Object(p.jsx)(l.b,{path:"/login",exact:!0,component:K},"/login"),Object(p.jsx)(l.a,{to:"/login"},"redirect/login")],a=[Object(p.jsx)(l.b,{path:"/journal",exact:!0,children:Object(p.jsx)(de,{user:t})},"/journal"),Object(p.jsx)(l.b,{path:"/logout",exact:!0,children:Object(p.jsx)(z,{user:t})},"/logout"),Object(p.jsx)(l.a,{to:"/journal"},"redirect/journal")];return Object(p.jsx)(l.d,{location:e,children:t?a:r})}));i.a.render(Object(p.jsx)(c.a,{children:Object(p.jsx)(n.a.StrictMode,{children:Object(p.jsx)(ue,{})})}),document.getElementById("root"))}},[[70,1,2]]]);
//# sourceMappingURL=main.c23f550a.chunk.js.map